<!DOCTYPE html>
<html lang=”en”>

<head>
    <title>REplace text</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <h1>REplace text</h1>
    <label for="matchpat">Match pattern:&nbsp;</label><input type="text" id="matchpat" size=50>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_expressions/Cheatsheet" target="_blank">cheatsheet</a><br>
    <label for="reppat">Replace pattern:&nbsp;</label><input type="text" id="reppat" size=50>
    match: $&amp; - precedes: $`- follows: $' - group: $n - named: $&lt;Name&gt;<br>
    <label for="multiline">Match scope:&nbsp;</label>
    <select id="multiline">
        <option value="F">Full (^ and $ on doc level)</option>
        <option value="M" selected="selected">Full (^ and $ on line level)</option>
        <option value="L">Line by Line match</option>
    </select><br>
    <input type="checkbox" id="ic">Ignore case<br>
    <input type="checkbox" id="global" checked>Global match (more than 1 match possible)

    <h2>Input <button onclick="fromCP()">Get From Clipboard</button></h2>
    <textarea id="intext" rows="10" cols="150"></textarea><br>

    <h2>Output <button onclick="toCP">Copy to Clipboard</button></h2>
    <textarea id="outtext" rows="10" cols="150" readonly></textarea><br>

</body>
<script type="module">
    import { gE, gV, gC, doSetup, sErr, sOK } from './js/lib.js';
    function run() {
        var scope = gV("multiline");
        var options = (gC("ic") ? "i" : "") + (gC("global") ? "g" : "") + (scope == "M" ? "m" : "")

        // execute replace on full text or each line depending on scope/multiline setting
        try {
            var re = new RegExp(gE("matchpat").value, options);
            if (scope == "L") {
                gE("outtext").value = gV("intext").split('\n').map(l => l.replace(re, gV("reppat"))).join("\n");
            } else {
                gE("outtext").value = gV("intext").replace(re, gV("reppat"));
            }
            sOK("matchpat");
        } catch (e) {
            sErr("matchpat");
            gE("outtext").value = e.name + e.message;
        }
    }
    doSetup(run);
</script>

</html>