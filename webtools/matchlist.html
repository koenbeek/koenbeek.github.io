<!DOCTYPE html>
<html lang=”en”>

<head>
    <title>List Matches</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <h1>List Matches</h1>

    <label for="matchpat">Match pattern:&nbsp;</label><input type="text" id="matchpat" size=50>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_expressions/Cheatsheet" target="_blank">cheatsheet</a><br>
    <label for="listpat">List pattern:&nbsp;</label><input type="text" id="listpat" size=50 value="$&">
    match: $&amp; - group: $n - named: $&lt;Name&gt;<br>
    <label for="multiline">Match scope:&nbsp;</label>
    <select id="multiline">
        <option value="F">Full (^ and $ on doc level)</option>
        <option value="M" selected="selected">Full (^ and $ on line level)</option>
        <option value="L">Line by Line match</option>
    </select><br>
    <input type="checkbox" id="ic">Ignore case<br>
    <input type="checkbox" id="global" checked>Global match (more than 1 match possible)

    <h2>Input</h2>
    <textarea id="intext" rows="10" cols="150"></textarea><br>

    <h2>Output <button onclick='toCP()'>Copy to Clipboard</button></h2>
    <textarea id="outtext" rows="10" cols="150" readonly></textarea><br>

</body>
<script type="module">
    import { gE, gV, gC, toCP, doSetup, sErr, sOK } from './js/lib.js';
    function match() {
        var pat = gV("matchpat");
        if (pat == "") { gE("outtext").value = ""; return; }
        var scope = gV("multiline");
        var options = (gC("ic") ? "i" : "") + (gC("global") ? "g" : "") + (scope == "M" ? "m" : "")
        var matches = [];

        // helper function: add all matches in txt to the matches list
        function addm(txt) {
            var m = txt.match(re);
            (m != null) ? gC("global") ? matches = matches.concat(m) : matches.push(m[0]) : 1;
        };

        // execute matches on full text or each line depending on scope/multiline setting
        try {
            var re = new RegExp(pat, options);
            if (scope == "L") { gV("intext").split("\n").forEach(l => addm(l)); } else { addm(gV("intext")) }
            gE("outtext").value = matches.map(m => m.replace(re, gE("listpat").value)).join("\n");
            sOK("matchpat");
        } catch (e) {
            sErr("matchpat");
            gE("outtext").value = e.name + e.message;
        }
    }
    doSetup(match);
</script>

</html>